---
layout: post
title:  "spring - ì…ë¬¸2"
date:   2025-01-31 20:00 +09:00
categories: BE
---
> ì¸í”„ëŸ° ê¹€ì˜í•œë‹˜ ìŠ¤í”„ë§ ì…ë¬¸ ê°•ì˜ë¥¼ ë“£ê³  ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤   
https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EC%9E%85%EB%AC%B8-%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8#


## ì›¹ ê°œë°œ ë°©ì‹
1. ì •ì  ì»¨í…ì¸ 
2. MVC ì™€ í…œí”Œë¦¿ ì—”ì§„
3. API

## íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ
![Image](https://github.com/user-attachments/assets/7ae43fd3-5340-4d58-8ee5-58f494d04f21)
ì»¨íŠ¸ë¡¤ëŸ¬ : MVC ì˜ ì»¨íŠ¸ë¡¤ëŸ¬   
ì„œë¹„ìŠ¤ : í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„(íšŒì› ì¤‘ë³µ ê°€ì… x ë“± )   
ë¦¬í¬ì§€í† ë¦¬ : ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
ë„ë©”ì¸ : ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´(íšŒì›, ì£¼ë¬¸, ì¿ í° ë“± ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ëŠ” ê°ì²´)

---

### íšŒì› ë„ë©”ì¸ê³¼ ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°
> ë„ë©”ì¸

`spring.hello.spring>domain>Member`
```java
package spring.hello.spring.domain;

public class Member {
    private Long id;
    private String name; //ë©¤ë²„

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
    //getter setter
}
```
> ë¦¬í¬ì§€í† ë¦¬

`repository/MemberRepository`
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.List;
import java.util.Optional;

public interface MemberRepository {
    Member save(Member member);
    Optional<Member> findById(Long id);
    Optional<Member> findByName(String name);
    //NULL ì´ ë¦¬í„´ëì„ ë•Œì˜ ì˜ˆì™¸ë¥¼ ì‰½ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ Optional ì‚¬ìš©
    List<Member> findAll();
}
```
> ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´

`repository/MemoryMemberRepository `  
ğŸ“Œ option + enterë¡œ implement ì‰½ê²Œ êµ¬í˜„   
ğŸ“Œ ì„í¬íŠ¸ëŠ” option + enter ë˜ëŠ” ctrl + space
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.*;

public class MemoryMemberRepository implements MemberRepository{

    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L; //0,1,2 í‚¤ê°’ ìƒì„±
    @Override
    public Member save(Member member) {
        member.setId(++sequence); //id ì„¸íŒ…
        store.put(member.getId(), member); //ìŠ¤í† ì–´ ì €ì¥
        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        return Optional.ofNullable(store.get(id)); //optionalë¡œ nullì´ì–´ë„ ê°ìŒ€ ìˆ˜ ìˆìŒ
    }

    @Override
    public Optional<Member> findByName(String name) {
        return store.values().stream()
                .filter(member -> member.getName().equals(name))
                .findAny();
    }

    @Override
    public List<Member> findAll() {
        return new ArrayList<>(store.values()); // ì „ì²´ value(=Member)ë“¤ì„ ë¦¬í„´
    }
}
```
ğŸ“Œ java
1. store.values() : 
    - Mapì— ì €ì¥ëœ ëª¨ë“  valueë“¤ì„ Collection í˜•íƒœë¡œ ë°˜í™˜
2. .stream()
    - store.values()ë¡œ ì–»ì€ Collectionì„ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë³€í™˜
3. .filter(member -> member.getName().equals(name))
    - ëŒë‹¤ í‘œí˜„ì‹ìœ¼ë¡œ memberì˜ getName() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ë°˜í™˜ëœ ê°’ì´ nameê³¼ ê°™ì€ì§€ë¥¼ íŒë‹¨
    - trueì¸ ìš”ì†Œë“¤ë§Œ ë‚¨ê¸°ê³  ê·¸ë ‡ì§€ ì•Šì€ ìš”ì†Œë“¤ì€ ìŠ¤íŠ¸ë¦¼ì—ì„œ ì œê±°í•´ì„œ í•„í„°ë§
4. .findAny()
    - í•„í„°ë§ëœ ìŠ¤íŠ¸ë¦¼ì—ì„œ ì„ì˜ì˜ í•˜ë‚˜ì˜ ìš”ì†Œë¥¼ ì°¾ì•„ ë°˜í™˜
    - ë°˜í™˜ íƒ€ì…ì€ `Optional<Member>`
    - ì°¾ì€ ìš”ì†Œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìš”ì†Œë¥¼ ê°ì‹¸ì„œ ë°˜í™˜í•˜ê³  ì—†ìœ¼ë©´ `Optional.empty()`ë¥¼ ë°˜í™˜

---
### íšŒì› ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì½”ë“œ
ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦   
`MemoryMemberRepositoryTest.java`
```java
class MemoryMemberRepositoryTest {

    MemoryMemberRepository repository = new MemoryMemberRepository();

    @Test
    public void save(){
        Member member = new Member();
        member.setName("spring");

        repository.save(member);

        Member result = repository.findById(member.getId()).get(); // Optioanlì—ì„œ ê°’ì„ êº¼ë‚¼ ë•ŒëŠ” get()ìœ¼ë¡œ
        //System.out.println("result =" + (result == member)); ë¡œë„ í™•ì¸ ê°€ëŠ¥
        ////Assertions.assertEquals(member, result); ë¡œë„ í™•ì¸ ê°€ëŠ¥

        // test
        // member ì™€ result ê°€ ê°™ì€ì§€ ê²€ì‚¬
        assertThat(member).isEqualTo(result);
    }

    @Test
    public void findByName(){
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        //ë©¤ë²„ í•˜ë‚˜ ë” ì¶”ê°€
        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        Member result = repository.findByName("spring1").get();

        assertThat(result).isEqualTo(member1);

    }

    @Test
    public void findAll(){
        Member member1 = new Member();
        member1.setName("spring1");
        repository.save(member1);

        Member member2 = new Member();
        member2.setName("spring2");
        repository.save(member2);

        List<Member> result = repository.findAll();

        assertThat(result.size()).isEqualTo(2);

    }
}
```
ğŸ“Œ ë³€ìˆ˜ renameì€ ctrl + shift + R ë˜ëŠ” fn + shift + f6ìœ¼ë¡œ í•œ ë²ˆì— í•˜ê¸°   


âœ… ì „ì²´ ì½”ë“œë¥¼ ëŒë ¤ë³´ë©´ ì—ëŸ¬ê°€ ë‚¨ ->
- í…ŒìŠ¤íŠ¸ ì½”ë“œ ë©”ì„œë“œëŠ” ì„ì˜ëŒ€ë¡œ ì‹¤í–‰
- findAll() ë©”ì„œë“œì—ì„œ repository ì— ì´ë¦„ì´ spring1 ì¸ member1 ì„ save í–ˆëŠ”ë°,
ë’¤ì´ì–´ ì‹¤í–‰ë˜ëŠ” findByName() ë©”ì„œë“œì—ì„œ ì´ë¦„ì´ spring1 ì¸ ê°ì²´ë¥¼ ì´ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŒ
- ì„œë¡œ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œê°€ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ì—ì„œ ì¶©ëŒ
- í…ŒìŠ¤íŠ¸ë©”ì„œë“œê°€ ëë‚˜ë©´ ì‚¬ìš©í•œ ë°ì´í„°ë¥¼ ì´ˆê¸°í™” í•´ì¤˜ì•¼ í•¨  
 
---
`MemoryMemberRepositoryTest.java`
```java
@AfterEach
    public void afterEach() {
        repository.clearStore();
    } //store ì´ˆê¸°í™”
```
`repository/MemoryMemberRepository.java`
```java
public void clearStore() {
        store.clear();
    }
```

## íšŒì› ì„œë¹„ìŠ¤ ê°œë°œ
### íšŒì› ê°€ì…
`service/MemberService`
```java
public class MemberService {

	private final MemberRepository memberRepository = new MemoryMemberRepository();

	// íšŒì›ê°€ì…
	public Long join(Member member) {
		// ê°™ì€ ì´ë¦„ì´ ìˆëŠ” ì¤‘ë³µ íšŒì› X
		memberRepository.findByName(member.getName())
				.ifPresent(m -> {
					throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
				}); // ì´ ë°©ì‹ ê¶Œì¥

		/* 
        Optional<Member> result = memberRepository.findByName(member.getName());
        
        result.ifPresent(m -> {
			throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
		}); // resultê°€ nullì´ ì•„ë‹Œ ë‹¤ë¥¸ ê°’ì´ ìˆìœ¼ë©´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤ ëœ¨ê²Œ í•˜ê¸°
		*/

		memberRepository.save(member);
		return member.getId();

	}

    // ì „ì²´ íšŒì› ì¡°íšŒ
	public List<Member> findMembers() {
		return memberRepository.findAll();
	}

	// íšŒì› í•œ ëª… ì¡°íšŒ
	public Optional<Member> findOne(Long memberId) {
		return memberRepository.findById(memberId);
	}
}
```
ğŸ“Œ cmd + option + vë¡œ ë³€ìˆ˜ ì¶”ì¶œ ê°€ëŠ¥   
ğŸ“Œ ctrl + t í•˜ê³  8ë²ˆ extract method í•˜ê±°ë‚˜ ê·¸ëƒ¥ ë°”ë¡œ extract method(cmd + option + m) í•˜ê¸° -> more optionìœ¼ë¡œ í•¨ìˆ˜ëª… ì„¤ì •   


## íšŒì› ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
`MemberServiceTest.java`   
ğŸ“Œ cmd + shift + të¡œ í…ŒìŠ¤íŠ¸ì½”ë“œ ë°”ë¡œ ë§Œë“¤ê¸° ê°€ëŠ¥
```java
class MemberServiceTest {

    MemberService memberService = new MemberService();
    MemoryMemberRepository memberRepository = new MemoryMemberRepository();

    @AfterEach
    public void afterEach() {
        memberRepository.clearStore();
    }

    @Test
    void íšŒì›ê°€ì…() { //testì½”ë“œëŠ” í•œê¸€ ê°€ëŠ¥
        //given
        Member member = new Member();
        member.setName("hello");

        //when
        Long saveId = memberService.join(member);

        //then
        Member findMember = memberService.findOne(saveId).get();
        assertThat(member.getName()).isEqualTo(findMember.getName());
    }

    @Test
    public void ì¤‘ë³µíšŒì›ì˜ˆì™¸(){
        // given
        Member member1 = new Member();
        member1.setName("spring");

        Member member2 = new Member();
        member2.setName("spring");

        // when
        memberService.join(member1);
        /*
        try {
            memberService.join(member2);
            fail();
        } catch (IllegalStateException e){
             assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }*/

        //then
        IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));
        assertThat(e.getMessage()).isEqualTo("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
    }

    @Test
    void findMembers() {
    }

    @Test
    void findOne() {
    }
}
```
âœ… `IllegalStateException e = assertThrows(IllegalStateException.class, () -> memberService.join(member2));`
- ë‘ ë²ˆì§¸ ì¸ìì¸ ëŒë‹¤í•¨ìˆ˜ ì‹¤í–‰ ì‹œ, ì²« ë²ˆì§¸ ì¸ìê°’ì¸ IllegalStateExceptionì´ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸



ğŸ“Œ ctrl + rë¡œ ì´ì „ì— ì‹¤í–‰í–ˆë˜ ê±° ë°”ë¡œ ì‹¤í–‰   
ğŸ“Œ cmd + b ë¡œ navigate

---
`MemberService.java`
```java
private final MemberRepository memberRepository;

    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }
```
âœ… memberRepositoryë¥¼ ì§ì ‘ newë¡œ ìƒì„±í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ ì™¸ë¶€ì—ì„œ ë„£ì–´ì£¼ë„ë¡ ìˆ˜ì •

---
`MemberServiceTest.java`
```java
class MemberServiceTest {

    MemberService memberService;
    MemoryMemberRepository memberRepository; //1

    @BeforeEach
    public void beforeEach() {
        memberRepository = new MemoryMemberRepository();
        memberService = new MemberService(memberRepository);
    }
    //ìƒëµ..
}
```
ê° í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— `MemoryMemberRepository`ë¥¼ ë§Œë“¤ê³  1ì—ë‹¤ ë„£ì–´ì¤Œ, ê±”ë¥¼ `memberService`ì— ë„£ì–´ì¤Œ, ê°™ì€ MemoryMemberRepository ì‚¬ìš© -> DI